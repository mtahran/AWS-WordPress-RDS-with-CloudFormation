AWSTemplateFormatVersion: '2010-09-09'
Description: Creates an EC2 with Apache, PHP and WP
Parameters:
  NetworkStackName:
    Description: Name the active CloudFormation stack that contains the networking
      resources that will be used in this stack.
    Type: String
    MinLength: 1
    MaxLength: 255
    AllowedPattern: "^[a-zA-Z][-a-zA-Z0-9]*$"
    Default: SampleNetworkCrossStack
Resources:
  EC2Instance:
    Type: 'AWS::EC2::Instance'
    Properties:
      ImageId: ami-0715c1897453cabd1
      InstanceType: t2.micro
      KeyName: macbook@400048mbp
      SubnetId: !ImportValue PublicSubnet1
      SecurityGroupIds:
        - !ImportValue MySGWP
      UserData:
        Fn::Base64: !Sub |
          #!/bin/bash -xe
          sudo dnf update -y
          sudo dnf install -y httpd php
          sudo systemctl enable httpd
          sudo systemctl start httpd
          sudo cd /var/www/html
          sudo wget https://wordpress.org/latest.tar.gz
          sudo tar -xzvf latest.tar.gz
          sudo cp -R wordpress/* .
          sudo rm -rf wordpress latest.tar.gz
          sudo chown -R www-data:www-data *
          sudo chmod -R 755 wp-content
Outputs:
  InstanceId:
    Value: !Ref EC2Instance
    Export:
      Name: EC2InstanceId
